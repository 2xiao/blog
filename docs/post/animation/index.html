<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://2xiao.github.io/blog/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/github.min.css' />
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/github-style.css' />
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/light.css' />
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/dark.css' />
    <link rel="stylesheet" href='https://2xiao.github.io/blog/css/syntax.css' />
    <title>【小程序】炫酷点赞动画实现方案 - 二小の博客</title>
    
    <link rel="icon" type="image/x-icon" href='https://2xiao.github.io/blog/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="如何用CSS实现一个复杂的点赞动画
" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://2xiao.github.io/blog/post/animation/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="【小程序】炫酷点赞动画实现方案 - 二小の博客" />
<meta name="twitter:description"
  content="如何用CSS实现一个复杂的点赞动画
" />
<meta name="twitter:site" content="https://2xiao.github.io/blog" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://2xiao.github.io/blog">


<meta property="og:type" content="article" />
<meta property="og:title" content="【小程序】炫酷点赞动画实现方案 - 二小の博客">
<meta property="og:description"
  content="如何用CSS实现一个复杂的点赞动画
" />
<meta property="og:url" content="https://2xiao.github.io/blog/post/animation/" />
<meta property="og:site_name" content="【小程序】炫酷点赞动画实现方案" />
<meta property="og:image"
  content="https://2xiao.github.io/blog">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-06-25 11:00:19 &#43;0800 CST" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://2xiao.github.io/blog">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://2xiao.github.io/blog">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://2xiao.github.io/blog">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://2xiao.github.io/blog">
                  <img class=" avatar-user"
                    src="https://2xiao.github.io/blog/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://2xiao.github.io/blog">二小</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://2xiao.github.io/blog/post/animation/">【小程序】炫酷点赞动画实现方案</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 25 Jun 2019 11:00:19 &#43;0800"
                    class="no-wrap">
                    Tue, 25 Jun 2019 11:00:19 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Wed, 17 Mar 2021 11:57:16 &#43;0800"
                    class="no-wrap">
                    Wed, 17 Mar 2021 11:57:16 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div class="file-header d-flex flex-md-items-center flex-items-start">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    1890 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/blog/tags/javascript">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      JavaScript
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><p>如何用CSS实现一个复杂的点赞动画</p>
<h2 id="1效果演示">1.效果演示</h2>
<p>在小程序中有很多用户交互的场景，例如转发，点赞等，之前的点赞一般采用两张「未点赞 / 已点赞」的图片做成雪碧图来实现，这样用户点击时只能感受到一个静态的生硬的变化。为了加强点赞后的反馈感，我们给点赞增加了动画效果，如下：</p>
<p><img src="http://mat1.gtimg.com/www/js/news/like4.gif" alt=""></p>
<p>这种效果是如何实现的呢？</p>
<h2 id="2实现分析">2.实现分析</h2>
<p>在css中，有一个计时函数<code>animation-timing-function</code>属性，该属性可以作用于整个动画中，定义了动画的每次循环是如何随时间递进的，属性的可能值为一或多个<code> &lt;timing-function&gt;</code>，比如有</p>
<ul>
<li><code>linear</code></li>
<li><code>ease</code></li>
<li><code>ease-in</code></li>
<li><code>ease-out</code></li>
<li><code>ease-in-out</code></li>
<li><code>cubic-bezier(n,n,n,n)</code></li>
<li>阶跃函数<code>steps(n,start/end)</code>。</li>
</ul>
<p>对于关键帧动画来说，<code>timing function</code>作用于一个关键帧周期而非整个动画周期，即从关键帧开始开始，到关键帧结束结束。各个关键帧都有单独的计时函数。这时的计时其实指的的帧之间的时间函数，顺序播放的动画，结尾关键帧的计时函数不会生效。</p>
<p>在这个动画中，我们正是使用了<code>animation-timing-function</code>的阶跃函数<code>steps()</code>，使用这个函数来控制一组包含渐变效果的点赞图（如下图），按照设置好的合适的步数和时间间隔播放，同时在水平轴跳跃的移动图片，就能达到我们的效果。</p>
<p><img src="http://mat1.gtimg.com/www/js/news/like_icon_wx.png" alt=""></p>
<h2 id="3代码实现">3.代码实现</h2>
<p>使用上文提到的一张特殊的多帧点赞图作为背景</p>
<pre><code>.agree-icon {
  width: 50rpx;
  height: 50rpx;
  background-repeat: no-repeat;
  background-image: url('./like_icon.png');
  background-position: left;
  background-size: 1400% 100%;
}
</code></pre><p>设置动画<code>animation-timing-function</code>的阶跃函数<code>steps()</code>，这里需要明确一下，<code>steps()</code>是一个阶跃函数，函数曲线不是连续的，因为图片一共有14张，存在13个间隔，所以，我们设置阶跃的步数为13。</p>
<p>当用户点赞时，我们为<code>.agree-icon</code>增加一个<code>.like-active</code>的属性，此属性设置了背景图片按照<code>@keyframes plus-one</code>中所设置的样式从左往右移动，移动的动画为<code>animation-timing-function</code>所设置的13步，还可以通过设置<code>animation-duration</code>的值来控制动画的总时长。</p>
<pre><code>.like-active {
  animation-timing-function: steps(13);
  animation-name: plus-one;
  animation-duration: .58s;
  animation-iteration-count: 1;
  display: inline-block;
  animation-fill-mode: forwards;
}

@keyframes plus-one {
  0% {
    background-position: left;
  }
  100% {
    background-position: right;
  }
}
</code></pre><h2 id="4进阶动画">4.进阶动画</h2>
<p>下面我们来看一个更复杂的点赞动画，用户每次点击都会有大小和方向随机的表情包四散飞射出来，同样可以使用CSS的计时函数<code>animation-timing-function</code>属性来实现。</p>
<p><img src="http://mat1.gtimg.com/www/js/news/likes.gif" alt=""></p>
<p>我们可以将这个复杂的动画分解，先实现单次点击的点赞动画（如下图），实现原理和上述方法一样，也是用一张特殊的多帧点赞图作为背景，然后设置
<code>animation-timing-function</code>和<code>background-size</code>属性。</p>
<p><img src="http://mat1.gtimg.com/www/js/news/rocket-eg.png" alt=""></p>
<p>接下来，只需要循环渲染出此动画元素，并且使用随机函数来控制元素有不同的大小和位置即可。</p>
<p>具体代码如下：</p>
<pre><code>getAniCon: function () {
  const aniCon = []
  for (let i = 0; i &lt; 21; i++) {
    const angle = (Math.random() - 0.6) * 160 // 旋转角度为左右各0-80度
    const scale = Math.random() * 0.8 + 1     // 缩放比例为1-180%
    const opacity = Math.random() * 0.1 + 0.9 // 透明度范围为60%-100%
    const bottom = i &gt; 10 ? 0 : -54
    const left = (i - 1) % 10 * -264

    const item = {}
    item.angle = angle
    item.numStyle = `background-position: bottom ${bottom}rpx left ${left}rpx;`
    item.rocketStyle = `transform: rotate(${angle}deg);
      width: ${scale * 500}rpx;
      height: ${scale * 250}rpx;
      background-size: ${scale * 6000}rpx ${scale * 250}rpx;
      bottom: ${scale * 30}rpx;
      right: ${scale * -150}rpx;`
    item.opacity = opacity
    aniCon.push(item)
  }
  return aniCon
},
</code></pre><p>为了方便理解和区分，我为每一个点赞动画都加一个灰色背景，如下：</p>
<p><img src="http://mat1.gtimg.com/www/js/news/like.gif" alt=""></p>
<h2 id="5性能优化">5.性能优化</h2>
<p>使用循环渲染出来的点赞动画虽然简单粗暴，但是会带来很多性能问题，比如：dom元素冗余导致的卡顿，动画元素的<code>z-index</code>过高导致的<code>click</code>事件被遮挡等，所以，我们还需要对此动画进行一些优化。</p>
<p>针对循环渲染出来的dom元素冗余导致的卡顿问题，我们使用两个参数来优化，一个是<strong>是否正在点赞</strong>，一个是<strong>点赞次数</strong>，其中，是否正在点赞是通过截流函数<code>debounce</code>，对点击事件增加500毫秒间隔来判断的，仅当用户正在点赞，且当前动画的<code>index</code>值满足<code>index &gt;= clickTimes || index + 3 &lt;= clickTimes</code>时，才会渲染该动画元素，这样页面中最多会有4个动画节点在同时播放，其他的动画节点都会被销毁。</p>
<p>针对动画元素的<code>z-index</code>过高导致的<code>click</code>事件被遮挡的问题，我们同样可以通过<strong>是否正在点赞</strong>这个参数，来动态控制点赞dom和动画节点dom的<code>z-index</code>值，这样就可以保证动画播放时依然可以连续点赞，以及点赞后不影响页面中其他元素的显示。</p>
<p>这里要多说一句，在调试层级问题时发现设置<code>z-index</code> 有时是无效的，后查明原因是：<code>z-index</code> 只能在<code>position</code> 属性值为<code>relative </code>或<code>absolute</code> 或<code>fixed</code> 的元素上有效；<code>z-index</code> 值只决定同一父元素中的同级子元素的堆叠顺序。</p>
<p>至此，炫酷的点赞动画的实现方案细节和难点都记录在此了，欢迎感兴趣的同学一起讨论交流。</p></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://2xiao.github.io/blog">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0"><a href='https://github.com/2xiao'>2xiao</a> の blog</li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://2xiao.github.io/blog/js/github-style.js"></script>



</html>